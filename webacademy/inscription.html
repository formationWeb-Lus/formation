<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - CréaWeb Academy</title>
    <link rel="stylesheet" href="styles/inscription.css">

    <!-- Google Analytics GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YJ17KCLW8N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YJ17KCLW8N');
    </script>

    <!-- Facebook Pixel -->
    <script>
      !function(f,b,e,v,n,t,s){
        if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
      }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1033257251452638');
      fbq('track', 'PageView');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=1033257251452638&ev=PageView&noscript=1"/>
    </noscript>
</head>
<body>
<header>
    <div class="logo">
        <img src="images/logo.png" alt="WebAcademy Logo" style="max-height: 80px;">
    </div>
    <nav>
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="detail.html">Cours</a></li>
            <li><a href="history.html">À propos</a></li>
            <li><a href="infodecompte.html">Explorer</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>
</header>

<main>
    <h1>Formulaire d'inscription</h1>
    <p>Veuillez remplir correctement vos informations pour finaliser votre inscription.</p>

    <form id="captureForm">
        <div class="row">
            <div class="field">
                <label for="prenom">Prénom</label>
                <input type="text" id="prenom" name="prenom" required>
            </div>
            <div class="field">
                <label for="nom">Nom</label>
                <input type="text" id="nom" name="nom" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="pays">Pays</label>
                <input type="text" id="pays" name="pays" required>
            </div>
            <div class="field">
                <label for="ville">Ville</label>
                <input type="text" id="ville" name="ville" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="code_postal">Code Postal</label>
                <input type="text" id="code_postal" name="code_postal" required>
            </div>
            <div class="field">
                <label for="telephone">Numéro de Téléphone</label>
                <input type="tel" id="telephone" name="telephone" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="email">Adresse Email</label>
                <input type="email" id="email" name="email" required>
            </div>
        </div>

        <h2>Choisissez votre formation :</h2>
        <div class="cours-container">
            <div class="cours-card">
                <h3>Débutant (Gratuit)</h3>
                <label><input type="checkbox" name="cours" value="html-css-debutant"> HTML</label>
                <label><input type="checkbox" name="cours" value="css-debutant"> CSS</label>
            </div>
            <div class="cours-card">
                <h3>Avancé (10 $ / 10 semaines)</h3>
                <label><input type="checkbox" name="cours" value="intro-js"> Introduction à JavaScript</label>
                <label><input type="checkbox" name="cours" value="variables"> Les variables</label>
                <label><input type="checkbox" name="cours" value="conditions"> La programmation constructive</label>
                <label><input type="checkbox" name="cours" value="dom"> La manipulation du DOM</label>
                <label><input type="checkbox" name="cours" value="objets"> Les objets</label>
                <label><input type="checkbox" name="cours" value="debug"> Le débogage</label>
                <label><input type="checkbox" name="cours" value="tableaux"> Les tableaux</label>
                <label><input type="checkbox" name="cours" value="fonctions"> Les fonctions</label>
                <label><input type="checkbox" name="cours" value="objets-avances"> Les objets avancés</label>
                <label><input type="checkbox" name="cours" value="callbacks"> Les fonctions de rappel (callbacks)</label>
                <label><input type="checkbox" name="cours" value="local-storage"> Le stockage local</label>
            </div>
        </div>

        <button type="submit" class="submit-btn">S'inscrire</button>
    </form>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDzMpVFXdYEQ_4ch3GthMvF52hIRce9qD8",
        authDomain: "inscriptionapp-ddb3e.firebaseapp.com",
        projectId: "inscriptionapp-ddb3e",
        storageBucket: "inscriptionapp-ddb3e.firebasestorage.app",
        messagingSenderId: "213159898520",
        appId: "1:213159898520:web:a986ee20ed1762b4e58fed"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("captureForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            const formData = {};
            ["nom", "prenom", "pays", "ville", "code_postal", "telephone", "email"].forEach(id => {
                formData[id] = document.getElementById(id).value.trim();
                if (!formData[id]) throw alert("Veuillez remplir tous les champs !");
            });

            formData.cours = [];
            document.querySelectorAll('input[name="cours"]:checked').forEach(cb => formData.cours.push(cb.value));

            try {
                await addDoc(collection(db, "inscriptions"), { ...formData, timestamp: serverTimestamp() });

                // Pixel Facebook
                fbq('track', 'CompleteRegistration');

                // GA4 event
                gtag('event', 'complete_registration', {
                    event_category: 'engagement',
                    event_label: 'Inscription CréaWeb Academy'
                });

                // ✅ Redirection directe vers infodecompte.html
                window.location.href = "infodecompte.html";
            } catch (error) {
                console.error("Erreur d'enregistrement :", error);
                alert("Une erreur est survenue. Veuillez réessayer plus tard.");
            }
        });
    });

    function toggleMenu() {
        document.querySelector("nav ul").classList.toggle("active");
    }
</script>

</main>

<footer>
    <p>&copy; 2025 CréaWeb Academy - Tous droits réservés</p>
</footer>
</body>
</html>
