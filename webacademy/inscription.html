<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - Cr√©aWeb Academy</title>
    <link rel="stylesheet" href="styles/inscription.css">

    <!-- Google Analytics GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YJ17KCLW8N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-YJ17KCLW8N');
    </script>

    <!-- Facebook Pixel -->
    <script>
      !function(f,b,e,v,n,t,s){
        if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)
      }(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
      fbq('init', '1033257251452638');
      fbq('track', 'PageView');
    </script>
    <noscript>
      <img height="1" width="1" style="display:none"
           src="https://www.facebook.com/tr?id=1033257251452638&ev=PageView&noscript=1"/>
    </noscript>
</head>
<body>
<header>
    <div class="logo">
        <img src="images/logo.png" alt="WebAcademy Logo" style="max-height: 80px;">
    </div>
    <nav>
        <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
        <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="detail.html">Cours</a></li>
            <li><a href="history.html">√Ä propos</a></li>
            <li><a href="page_d'information.html">Explorer</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>
</header>

<main>
    <h1>Formulaire d'inscription</h1>
    <p style="color:green; font-weight:bold;">
        üí° merci pour votre inscription de <strong>5$</strong>. Veuillez remplir correctement vos informations.
    </p>

    <form id="captureForm">
        <div class="row">
            <div class="field">
                <label for="prenom">Pr√©nom</label>
                <input type="text" id="prenom" name="prenom" required>
            </div>
            <div class="field">
                <label for="nom">Nom</label>
                <input type="text" id="nom" name="nom" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="pays">Pays</label>
                <input type="text" id="pays" name="pays" required>
            </div>
            <div class="field">
                <label for="ville">Ville</label>
                <input type="text" id="ville" name="ville" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="code_postal">Code Postal</label>
                <input type="text" id="code_postal" name="code_postal" required>
            </div>
            <div class="field">
                <label for="telephone">Num√©ro de T√©l√©phone</label>
                <input type="tel" id="telephone" name="telephone" required>
            </div>
        </div>

        <div class="row">
            <div class="field">
                <label for="email">Adresse Email</label>
                <input type="email" id="email" name="email" required>
            </div>
        </div>

        <h2>Choisissez vos cours :</h2>
        <div class="cours-container">
            <div class="cours-card">
                <h3>D√©butant</h3>
                <label><input type="checkbox" name="cours" value="html-css-debutant"> HTML & CSS</label>
                <label><input type="checkbox" name="cours" value="javascript-debutant"> JavaScript</label>
                <label><input type="checkbox" name="cours" value="python-debutant"> Python</label>
                <label><input type="checkbox" name="cours" value="mysql-debutant"> MySQL</label>
            </div>
            <div class="cours-card">
                <h3>Avanc√©</h3>
                <label><input type="checkbox" name="cours" value="html-css-avance"> HTML & CSS</label>
                <label><input type="checkbox" name="cours" value="javascript-avance"> JavaScript</label>
                <label><input type="checkbox" name="cours" value="python-avance"> Python</label>
                <label><input type="checkbox" name="cours" value="mysql-avance"> MySQL</label>
                <label><input type="checkbox" name="cours" value="mongoDB-avance"> mongoDB</label>
                <label><input type="checkbox" name="cours" value="nodejs-avance"> node.js</label>
                <label><input type="checkbox" name="cours" value="pgadmin-avance"> pgAdmin</label>
                <label><input type="checkbox" name="cours" value="git-avance"> Git</label>
                <label><input type="checkbox" name="cours" value="github-avance"> GitHub</label>
            </div>
        </div>

        <div class="cours-card marketing-card">
            <h3>Marketing</h3>
            <label><input type="checkbox" name="cours" value="marketing-digital"> Marketing Digital</label>
        </div>

        <button type="submit" class="submit-btn">S'inscrire</button>
    </form>

    <!-- Firebase v9+ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDzMpVFXdYEQ_4ch3GthMvF52hIRce9qD8",
            authDomain: "inscriptionapp-ddb3e.firebaseapp.com",
            projectId: "inscriptionapp-ddb3e",
            storageBucket: "inscriptionapp-ddb3e.firebasestorage.app",
            messagingSenderId: "213159898520",
            appId: "1:213159898520:web:a986ee20ed1762b4e58fed"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener("DOMContentLoaded", function() {
            document.getElementById("captureForm").addEventListener("submit", async function(event) {
                event.preventDefault();

                const formData = {};
                ["nom", "prenom", "pays", "ville", "code_postal", "telephone", "email"].forEach(id => {
                    formData[id] = document.getElementById(id).value.trim();
                    if (!formData[id]) throw alert("Veuillez remplir tous les champs !");
                });

                formData.cours = [];
                document.querySelectorAll('input[name="cours"]:checked').forEach(cb => formData.cours.push(cb.value));

                try {
                    await addDoc(collection(db, "inscriptions"), { ...formData, timestamp: serverTimestamp() });

                    // Pixel Facebook
                    fbq('track', 'CompleteRegistration');

                    // GA4 event
                    gtag('event', 'complete_registration', {
                        event_category: 'engagement',
                        event_label: 'Inscription Cr√©aWeb Academy'
                    });

                    alert("Inscription r√©ussie !");
                    window.location.href = "merci.html";
                } catch (error) {
                    console.error("Erreur d'enregistrement :", error);
                    alert("Une erreur est survenue. Veuillez r√©essayer plus tard.");
                }
            });
        });

        function toggleMenu() {
            document.querySelector("nav ul").classList.toggle("active");
        }
    </script>
</main>

<footer>
    <p>&copy; 2025 Cr√©aWeb Academy - Tous droits r√©serv√©s</p>
</footer>
</body>
</html>
